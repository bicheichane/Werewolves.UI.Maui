@using Werewolves.Core.StateModels.Enums
@inject GameClientManager GameClient
@inject IconMap IconMap
@implements IDisposable

<MudExpansionPanels>
    @foreach (var player in GameClient.PlayerData ?? [])
    {
        var isDead = player.State.Health == PlayerHealth.Dead;
        <MudExpansionPanel Class="@(isDead ? "mud-text-disabled" : "")">
            <TitleContent>
                <div class="d-flex align-center gap-3">
                    <MudAvatar Color="@(isDead ? Color.Default : Color.Primary)" Style="@(isDead ? "opacity: 0.5" : "")">
                        @player.Name.Substring(0, 1)
                    </MudAvatar>
                    <div>
                        <MudText>@player.Name</MudText>
                        <MudText Typo="Typo.caption" Color="@(isDead ? Color.Error : Color.Success)">
                            @(isDead ? "Dead" : "Alive")
                        </MudText>
                    </div>
                </div>
            </TitleContent>
            <ChildContent>
                <!-- Role information (visible to moderator when expanded) -->
                <div class="d-flex align-center gap-2 pa-2">
                    @if (player.State.MainRole is not null)
                    {
                        <MudAvatar Size="Size.Small">
                            <MudImage Src="@($"Images/{IconMap.GetIcon(player.State.MainRole.Value)}")" Alt="@player.State.MainRole.ToString()" />
                        </MudAvatar>
                        <MudText>@player.State.MainRole</MudText>
                    }
                    else
                    {
                        <MudText Class="mud-text-disabled">Role not assigned</MudText>
                    }
                </div>
                <!-- Placeholder for future status effects (blocked on Core changes) -->
                <MudText Typo="Typo.caption" Class="mud-text-disabled pa-2">
                    Status effects: Coming soon
                </MudText>
            </ChildContent>
        </MudExpansionPanel>
    }
</MudExpansionPanels>

@code {
    protected override void OnInitialized()
    {
        GameClient.StateChanged += StateHasChanged;
    }

    public void Dispose()
    {
        GameClient.StateChanged -= StateHasChanged;
    }
}
