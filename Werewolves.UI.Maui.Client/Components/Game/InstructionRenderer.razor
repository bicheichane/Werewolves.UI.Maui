@using Werewolves.Core.StateModels.Models.Instructions
@inject GameClientManager GameClient
@implements IDisposable

<MudContainer MaxWidth="MaxWidth.Small" Class="pa-4">
    <MudText Typo="Typo.h5" Align="Align.Center" GutterBottom="true">Current Instruction</MudText>
    
    @if (GameClient.CurrentInstruction != null)
    {
        @* Public Announcement - Large text read aloud to players *@
        @if (!string.IsNullOrEmpty(GameClient.CurrentInstruction.PublicAnnouncement))
        {
            <MudAlert Severity="Severity.Info" Icon="@Icons.Material.Filled.Campaign" Class="mb-2">
                <MudText Typo="Typo.h6">@GameClient.CurrentInstruction.PublicAnnouncement</MudText>
            </MudAlert>
        }

        @* Private Instruction - Italicized moderator-only note *@
        @if (!string.IsNullOrEmpty(GameClient.CurrentInstruction.PrivateInstruction))
        {
            <MudAlert Severity="Severity.Warning" Icon="@Icons.Material.Filled.Lock" Class="mb-2">
                <MudText Typo="Typo.body2" Style="font-style: italic;">
                    @GameClient.CurrentInstruction.PrivateInstruction
                </MudText>
            </MudAlert>
        }

        @switch (GameClient.CurrentInstruction)
        {
            case AssignRolesInstruction assignRoles:
                <Werewolves.Client.Components.Game.Views.AssignRolesView Instruction="@assignRoles" />
                break;
            case SelectPlayersInstruction selectPlayers:
                <Werewolves.Client.Components.Game.Views.SelectPlayersView Instruction="@selectPlayers" />
                break;
            case SelectOptionsInstruction selectOptions:
                <Werewolves.Client.Components.Game.Views.SelectOptionsView Instruction="@selectOptions" />
                break;
            case ConfirmationInstruction confirmation:
                <Werewolves.Client.Components.Game.Views.ConfirmationView Instruction="@confirmation" />
                break;
            default:
                <MudAlert Severity="Severity.Warning">
                    Unknown instruction type: @(GameClient.CurrentInstruction?.GetType().Name ?? "null")
                </MudAlert>
                break;
        }
    }
    else
    {
        <MudAlert Severity="Severity.Info">Waiting for instruction...</MudAlert>
    }
    
</MudContainer>

@code {
    protected override void OnInitialized()
    {
        GameClient.StateChanged += StateHasChanged;
    }

    public void Dispose()
    {
        GameClient.StateChanged -= StateHasChanged;
    }
}
